<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="generator" content="Jekyll v4.1.1" />
    <title>用户注册</title>

    <!-- Alert 样式 -->
    <link rel="stylesheet" type="text/css" href="/sweetalert/sweetalert.css" />
    <script type="text/javascript" src="/sweetalert/sweetalert-dev.js"></script>

    <!-- Bootstrap & Jquery -->
    <script src="https://cdn.staticfile.org/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
      crossorigin="anonymous"
    />

    <!-- Custom styles for this template -->
    <link href="/css/common.css" rel="stylesheet" />
    <link href="/css/register.css" rel="stylesheet" />
  </head>
  <body class="text-center">
    <form
      id="register-form"
      class="form-signup"
      style="position: relative; top: 50%; transform: translateY(-50%)"
    >
      <img
        class="mb-4"
        src="/images/common/logo.JPG"
        alt=""
        width="172"
        height="172"
        style="border-radius: 20%"
      />
      <h1 class="h3 mb-3 font-weight-normal">用户注册</h1>
      <div class="d-flex flex-column justify-content-between">
        <div class="d-flex flex-column">
          <input
            name="username"
            type="text"
            id="username"
            class="form-control"
            placeholder="用户名"
            required
            autofocus
          />
          <div class="invalid-feedback">必填项</div>
        </div>

        <div class="d-flex flex-column">
          <input
            name="password"
            type="password"
            id="password"
            onkeyup="passwordCheck()"
            class="form-control"
            placeholder="密码"
            required
          />
          <div id="pwd-remind" class="invalid-feedback">必填项</div>
          <div style="position: relative; width: 0; height: 0">
            <span
              toggle="#password"
              class="fa fa-fw fa-eye field-icon toggle-password"
            ></span>
          </div>
        </div>
        <div class="d-flex flex-column">
          <input
            name="password-check"
            type="password"
            id="password-check"
            onkeyup="passwordCheck()"
            class="form-control"
            placeholder="确认密码"
            required
          />
          <div class="invalid-feedback">必填项</div>
        </div>
      </div>
      <div class="mb-3 d-flex flex-row justify-content-end">
        <a href="login">已有账号</a>
      </div>
      <input
        id="reg-btn"
        class="btn btn-lg btn-primary btn-block"
        type="button"
        value="注册"
      />
    </form>
    <script type="text/javascript">
      //前端验证
      function passwordCheck() {
        var pwd = $("#password").val();
        var pwd1 = $("#password-check").val();
        if (pwd == pwd1) {
          document.getElementById("pwd-remind").innerHTML =
            "<font style='position:relative;' color='green'>两次密码相同</font>";
          document.getElementById("pwd-remind").style.visibility = "visible";
          document.getElementById("reg-btn").disabled = false;
        } else {
          document.getElementById("pwd-remind").innerHTML =
            "<font style='position:relative;' color='red'>两次密码不相同</font>";
          document.getElementById("pwd-remind").style.visibility = "visible";

          document.getElementById("reg-btn").disabled = true;
        }
      }

      $("#reg-btn").click(function () {
        if (
          (document.getElementById("username").value != "") &
          (document.getElementById("password").value != "") &
          (document.getElementById("password-check").value != "")
        ) {
          if (
            !/^(?=.*[a-zA-Z])(?=.*\d)[A-Za-z\d]{8,16}$/.test(
              document.getElementById("password").value
            )
          ) {
            swal(
              "密码至少8个字符，至少1个字母和1个数字,不能包含特殊字符，最大长度为16位。",
              "",
              "error",
              { button: "确认" }
            );
            return;
          }

          var url = "register";
          // 请求参数
          var data = $("#register-form").serialize();
          // 发出ajax请求，并处理结果
          $.ajax({
            url: url,
            data: data,
            type: "POST",
            dataType: "json",
            success: function (json) {
              if (json.state == 200) {
                swal(
                  {
                    title: "注册成功!",
                    text: "点击确认跳转到登录页!",
                    type: "success",
                    button: "确认",
                  },
                  function () {
                    window.location.replace("/user/login");
                  }
                );
              } else {
                swal("注册失败!", json.message, "error", { button: "确认" });
              }
            },
          });
        } else {
          swal("请确认资料已输入完全!", "", "error", { button: "确认" });
        }
      });
      //设定Password eye 开关
      $(".toggle-password").click(function () {
        $(this).toggleClass("fa-eye fa-eye-slash");
        var input = $($(this).attr("toggle"));
        if (input.attr("type") == "password") {
          input.attr("type", "text");
          $("#password-check").attr("type", "text");
        } else {
          input.attr("type", "password");
          $("#password-check").attr("type", "password");
        }
      });
    </script>
  </body>
</html>
